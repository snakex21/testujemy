<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>eBooki - Lokalna Baza Wiedzy</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>

    <nav id="table-of-contents">
        <!-- Spis tre≈õci zostanie wygenerowany dynamicznie przez JavaScript -->
    </nav>

    <div class="main-wrapper">
        <header>
            <h1>eBooki i Audiobooki</h1>
            <a href="index.html" class="back-button">‚Üê Powr√≥t do strony g≈Ç√≥wnej</a>
        </header>

        <nav class="tabs">
            <!-- Poni≈ºej znajduje siƒô finalna wersja paska nawigacyjnego. -->

            <a href="ai.html" class="tab-link">
                <img src="icons/brain.svg" alt="AI">
            </a>
            <a href="edukacja.html" class="tab-link">
                <img src="icons/education-icon.svg" alt="Edukacja">
            </a>
            <a href="ebooki.html" class="tab-link active">
                <img src="icons/ebook.png" alt="eBooki">
            </a>
            <a href="filmy.html" class="tab-link">
                <img src="icons/play-video-150x150.png" alt="Filmy">
            </a>
            <a href="gry.html" class="tab-link">
                <img src="icons/joystick-150x150.png" alt="Gry">
            </a>
            <a href="komiksy.html" class="tab-link">
                <img src="icons/comic-book.png" alt="Komiksy">
            </a>
            <a href="linux-macos.html" class="tab-link">
                <img src="icons/linux-logo.svg" alt="Linux i macOS">
            </a>
            <a href="livetv.html" class="tab-link">
                <img src="icons/live-broadcast.png" alt="Live TV">
            </a>
            <a href="media-spolecznosciowe.html" class="tab-link">
                <img src="icons/users.svg" alt="Media Spo≈Çeczno≈õciowe">
            </a>
            <a href="miedzynarodowe.html" class="tab-link">
                <img src="icons/globe.svg" alt="Miƒôdzynarodowe">
            </a>
            <a href="muzyka.html" class="tab-link">
                <img src="icons/music-150x150.png" alt="Muzyka">
            </a>
            <a href="narzedzia-graficzne.html" class="tab-link">
                <img src="icons/paint-brush.svg" alt="Narzƒôdzia Graficzne">
            </a>
            <a href="narzedzia-plikow.html" class="tab-link">
                <img src="icons/file-tools.svg" alt="Narzƒôdzia Plikowe">
            </a>
            <a href="narzedzia-systemowe.html" class="tab-link">
                <img src="icons/system-tools.svg" alt="Narzƒôdzia Systemowe">
            </a>
            <a href="narzedzia-tekstowe.html" class="tab-link">
                <img src="icons/text-tools.svg" alt="Narzƒôdzia Tekstowe">
            </a>
            <a href="pobieranie.html" class="tab-link">
                <img src="icons/download.svg" alt="Pobieranie">
            </a>
            <a href="poradnik-gry.html" class="tab-link">
                <img src="icons/guide-book.svg" alt="Poradnik Gracza">
            </a>
            <a href="pozostale.html" class="tab-link">
                <img src="icons/box.svg" alt="Pozosta≈Çe">
            </a>
            <a href="programowanie.html" class="tab-link">
                <img src="icons/code-icon.svg" alt="Programowanie">
            </a>
            <a href="privacy.html" class="tab-link">
                <img src="icons/shield.svg" alt="Prywatno≈õƒá">
            </a>
            <a href="rozszerzenia.html" class="tab-link">
                <img src="icons/puzzle-icon.svg" alt="Rozszerzenia">
            </a>
            <a href="sport.html" class="tab-link">
                <img src="icons/basketball-150x150.png" alt="Sport">
            </a>
            <a href="telefony.html" class="tab-link">
                <img src="icons/smartphone.svg" alt="Telefony">
            </a>
            <a href="torrenty.html" class="tab-link">
                <img src="icons/utorrent-150x150.png" alt="Torrenty">
            </a>
            <a href="wideo.html" class="tab-link">
                <img src="icons/film-icon.svg" alt="Wideo">
            </a>
            <a href="wschodni-skarbiec.html" class="tab-link">
                <img src="icons/woman-150x150.png" alt="Wschodni Skarbiec">
            </a>
        </nav>

        <main class="button-container" id="content-container">
            <div id="content">
                <div class="loading">≈Åadowanie...</div>
            </div>
        </main>
    </div>

    <script src="dane/ebooki-dane.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const contentContainer = document.getElementById('content');
            const tocContainer = document.getElementById('table-of-contents');

            if (!contentContainer || !tocContainer || typeof pageData === 'undefined') {
                console.error("Nie znaleziono wymaganych element√≥w DOM lub obiektu pageData.");
                if (contentContainer) {
                    contentContainer.innerHTML = '<div class="error">WystƒÖpi≈Ç b≈ÇƒÖd podczas ≈Çadowania danych.</div>';
                }
                return;
            }

            const createLinkElement = (link) => {
                const linkElement = document.createElement('a');
                linkElement.href = link.url;
                linkElement.className = 'play-button';
                linkElement.target = '_blank';
                
                const img = document.createElement('img');
                img.src = 'icons/ebook-icon.svg';
                img.alt = 'Link';
                linkElement.appendChild(img);
                
                linkElement.appendChild(document.createTextNode(` ${link.name}`));
                
                return linkElement;
            };
            
            const createSectionElement = (section) => {
                const sectionContainer = document.createElement('section');
                sectionContainer.id = section.id;

                const title = document.createElement('h2');
                title.textContent = section.title;
                sectionContainer.appendChild(title);

                const grid = document.createElement('div');
                grid.className = 'category-grid';
                
                section.links.forEach(link => {
                    grid.appendChild(createLinkElement(link));
                });

                sectionContainer.appendChild(grid);
                return sectionContainer;
            };

            const generateTableOfContents = (sections) => {
                const title = document.createElement('h4');
                title.textContent = 'Spis Tre≈õci';
                tocContainer.appendChild(title);

                const list = document.createElement('ul');
                sections.forEach(section => {
                    const listItem = document.createElement('li');
                    const link = document.createElement('a');
                    link.href = `#${section.id}`;
                    link.textContent = section.title;
                    link.dataset.targetId = section.id;
                    listItem.appendChild(link);
                    list.appendChild(listItem);
                });
                tocContainer.appendChild(list);
            };
            
            const createInfoBox = (boxData) => {
                const box = document.createElement('div');
                box.className = boxData.type === 'info' ? 'info-box' : 'warning-box';
                const title = document.createElement('h3');
                title.textContent = boxData.title;
                const paragraph = document.createElement('p');
                paragraph.innerHTML = boxData.content;
                box.appendChild(title);
                box.appendChild(paragraph);
                return box;
            };

            const loadContent = () => {
                contentContainer.innerHTML = ''; 

                // --- START NOWO≈öCI ---
                const searchContainer = document.createElement('div');
                searchContainer.className = 'search-container';
                const searchBox = document.createElement('input');
                searchBox.type = 'text';
                searchBox.className = 'search-box';
                searchBox.id = 'searchBox';
                searchBox.placeholder = 'üîç Wyszukaj ksiƒÖ≈ºkƒô lub bibliotekƒô...';
                searchContainer.appendChild(searchBox);
                contentContainer.appendChild(searchContainer);
                // --- KONIEC NOWO≈öCI ---

                if (pageData.sections && pageData.sections.length > 0) {
                    pageData.sections.forEach(section => {
                        contentContainer.appendChild(createSectionElement(section));
                    });
                }
                
                if (pageData.infoBox) {
                    contentContainer.appendChild(createInfoBox(pageData.infoBox));
                }
                
                if (pageData.warningBox) {
                    contentContainer.appendChild(createInfoBox(pageData.warningBox));
                }

                generateTableOfContents(pageData.sections);
                initializeEventListeners();
                initializeScrollSpy();
            };

            // --- START NOWO≈öCI ---
            const initializeEventListeners = () => {
                // Logika dla spisu tre≈õci (p≈Çynne przewijanie)
                document.querySelectorAll('#table-of-contents a').forEach(link => {
                    link.addEventListener('click', function(e) {
                        e.preventDefault();
                        const targetId = this.getAttribute('href').substring(1);
                        const targetElement = document.getElementById(targetId);
                        if (targetElement) {
                            targetElement.scrollIntoView({ behavior: 'smooth' });
                        }
                    });
                });

                // Logika dla wyszukiwarki
                const searchBox = document.getElementById('searchBox');
                if (searchBox) {
                    searchBox.addEventListener('input', (e) => {
                        const searchTerm = e.target.value.toLowerCase();
                        const buttons = document.querySelectorAll('.play-button');
                        
                        buttons.forEach(button => {
                            const text = button.textContent.toLowerCase();
                            if (text.includes(searchTerm)) {
                                button.style.display = 'flex';
                            } else {
                                button.style.display = 'none';
                            }
                        });
                    });
                }
            };
            // --- KONIEC NOWO≈öCI ---
            
            const initializeScrollSpy = () => {
                const sections = pageData.sections.map(sec => document.getElementById(sec.id));
                const tocLinks = document.querySelectorAll('#table-of-contents a');
                
                if (sections.length === 0 || tocLinks.length === 0) return;

                const observer = new IntersectionObserver((entries) => {
                    let activeId = null;
                    
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            if (!activeId || entry.intersectionRatio > 0.5) {
                                activeId = entry.target.id;
                            }
                        }
                    });

                    // Fallback to the topmost visible element if multiple are in view
                    if (!activeId) {
                        const visibleSections = sections.filter(section => {
                            const rect = section.getBoundingClientRect();
                            return rect.top >= 0 && rect.bottom <= window.innerHeight;
                        });
                        if (visibleSections.length > 0) {
                            activeId = visibleSections[0].id;
                        }
                    }

                    tocLinks.forEach(link => {
                        link.classList.remove('active');
                        if (activeId && link.dataset.targetId === activeId) {
                            link.classList.add('active');
                        }
                    });

                }, { rootMargin: '-50% 0px -50% 0px', threshold: [0, 0.5, 1] });

                sections.forEach(section => {
                    if (section) observer.observe(section);
                });
            };

            loadContent();
        });
    </script>
</body>
</html>